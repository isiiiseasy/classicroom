<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>svgによるグラフ</title>
    <style>
        #graph {
            border-style: double;
            border-radius: 2px;
            height: 200;
            width: 300;
        }
        .my-bar{
            fill:#FF0000;
            fill-opacity:0.8;
        }
    </style>
</head>

<body>
    <script src="d3.min.js" charset="utf-8"></script>
    <svg id="graph">

        </svg>
        <p id="test_name"></p>
</body>
<script type="text/javascript">
    d3.csv("test_results.csv", function(error, list) {
        var x = d3.scaleBand()
            .rangeRound([0, 300])
            .padding(.1)
            .domain(list.map(function(d, i) {
                return d.test_name;
            }));
        var y = d3.scaleLinear()
            .range([0, 100])
            .domain([0, 100]);

        d3.select('#graph').selectAll('.my-bar')
            .data(list).enter()
            .append('rect')
            .on('mouseover',function(d,i){d3.select('#test_name').text(d.test_name);})
            .attr('class','my-bar')
            .attr('x', function(d, i) {
                return x(d.test_name);
            })
            .attr('width', x.bandwidth())
            .attr('y',100)
            .attr('height',0)
            .transition()
            .attr('y', function(d, i) {
                return 100-y(d.point);
            })
            .attr('height', function(d, i) {
                return y(d.point);
            })

            d3.select('#graph').selectAll('.my-point')
            .data(list).enter()
            .append('text')
            .attr('x', function(d, i) {
                return x(d.test_name);
            })
            .attr('y', function(d, i) {
                return 112-y(d.point);
            })
            .text(function(d,i){
                return d.point;
            })

    })
</script>

</html>
